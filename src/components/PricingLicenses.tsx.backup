import { motion, AnimatePresence } from "framer-motion";

import { useState } from "react";



type Licence = "individual" | "school" | "commercial";

type Billing = "monthly" | "yearly";



const startCheckout = (payload: { licence: Licence; billing?: Billing }) => {

  console.log("Starting checkout:", payload);

};



export default function PricingLicenses() {

  const [licence, setLicence] = useState<Licence>("individual");

  const [billing, setBilling] = useState<Billing>("yearly");



  const handlePrimaryAction = () => {

    if (licence === "commercial") {

      document.getElementById("contact")?.scrollIntoView({ behavior: "smooth" });

      return;

    }



    startCheckout({

      licence,

      billing: licence === "individual" ? billing : undefined,

    });

  };

  return (

    <section className="relative bg-[#E0F2FE] py-28 overflow-hidden">
      {/* Decorative background */}

      <div className="absolute inset-0 opacity-30 pointer-events-none">

        <div className="absolute top-16 left-20 w-40 h-40 bg-[#7EDC89] rounded-full blur-3xl" />

        <div className="absolute bottom-24 right-20 w-48 h-48 bg-[#00A4FF] rounded-full blur-3xl" />

      </div>

      <div className="relative mx-auto max-w-6xl px-6">

        {/* Header */}

        <div className="text-center mb-16">

          <h2 className="text-5xl md:text-6xl font-black text-[#16130F] mb-6">

            Pricing & licences

          </h2>

          <p className="max-w-2xl mx-auto text-xl text-[#6B7280]">

            Simple, fair pricing for educators and schools.  

            Commercial and software use is licensed separately.

          </p>

        </div>

        {/* Licence selector */}

        <div className="flex justify-center mb-12">

          <div className="bg-white rounded-2xl shadow-lg p-1 flex gap-1">

            {[

              { id: "individual", label: "Individual Educator" },

              { id: "school", label: "School" },

              { id: "commercial", label: "Commercial & District" },

            ].map((opt) => (

              <button

                key={opt.id}

                onClick={() => setLicence(opt.id as Licence)}

                className={`px-6 py-3 rounded-xl font-semibold transition-all ${

                  licence === opt.id

                    ? "bg-[#00827A] text-white"

                    : "text-[#6B7280] hover:bg-[#F1F5F9]"

                }`}

              >

                {opt.label}

              </button>

            ))}

          </div>

        </div>



        {/* Purchase card */}

        <AnimatePresence mode="wait">

          <motion.div

            key={licence}

            initial={{ opacity: 0, y: 20 }}

            animate={{ opacity: 1, y: 0 }}

            exit={{ opacity: 0, y: -10 }}

            transition={{ duration: 0.25 }}

            className="bg-white rounded-3xl shadow-2xl p-10 max-w-xl mx-auto"

          >
                {/* Individual Educator Panel */}
                {licence === "individual" && (
                  <div className="space-y-6">
                    <div>
                      <h4 className="text-3xl font-bold text-[#16130F]">Individual Educator</h4>
                      <p className="text-[#6B7280] mt-2">For teachers and homeschooling families.</p>
                    </div>

                    {/* Billing Toggle */}
                    <div className="bg-[#F8FAFC] rounded-2xl p-2">
                      <div className="grid grid-cols-2 gap-2">
                        <button
                          onClick={() => setBilling('monthly')}
                          className={`p-3 rounded-xl text-center transition-all ${
                            billing === 'monthly'
                              ? 'bg-[#00827A] text-white shadow-sm'
                              : 'text-[#6B7280] hover:bg-white/50'
                          }`}
                        >
                          Monthly
                        </button>
                        <button
                          onClick={() => setBilling('yearly')}
                          className={`p-3 rounded-xl text-center transition-all relative ${
                            billing === 'yearly'
                              ? 'bg-[#00827A] text-white shadow-sm'
                              : 'text-[#6B7280] hover:bg-white/50'
                          }`}
                        >
                          Yearly
                          {billing === 'yearly' && (
                            <span className="absolute -top-1 -right-1 bg-[#7EDC89] text-white text-xs px-1.5 py-0.5 rounded-full">
                              Best value
                            </span>
                          )}
                        </button>
                      </div>
                    </div>

                    {/* Pricing Display */}
                    <div className="text-center">
                      {billing === 'yearly' ? (
                        <>
                          <div className="text-5xl font-black text-[#16130F]">R149</div>
                          <div className="text-lg text-[#6B7280]">per year</div>
                          <div className="text-sm text-[#7EDC89] mt-1">Works out to ~R12.42 / month</div>
                        </>
                      ) : (
                        <>
                          <div className="text-5xl font-black text-[#16130F]">R29</div>
                          <div className="text-lg text-[#6B7280]">per month</div>
                          <div className="text-sm text-[#6B7280] mt-1">Cancel anytime</div>
                        </>
                      )}
                    </div>

                    {/* Features */}
                    <ul className="space-y-3">
                      {[
                        "All Edu-Aid fonts included",
                        "Print + PDF outputs for your learners",
                        "Updates included while subscribed",
                        "Email support"
                      ].map((feature) => (
                        <li key={feature} className="flex items-start gap-3">
                          <div className="mt-1 flex-shrink-0 w-5 h-5 rounded-full bg-[#00827A] flex items-center justify-center">
                            <svg className="w-3 h-3 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
                            </svg>
                          </div>
                          <span className="text-base leading-relaxed">{feature}</span>
                        </li>
                      ))}
                    </ul>

                    {/* CTA Button */}
                    <button
                      onClick={handlePurchase}
                      className="w-full bg-[#00827A] text-white py-4 px-8 rounded-2xl font-bold text-xl hover:bg-[#006B5E] transition-all duration-200 shadow-lg hover:shadow-xl"
                    >
                      {billing === 'yearly' ? 'Buy Individual (Yearly) — R149' : 'Buy Individual (Monthly) — R29/mo'}
                    </button>

                    {/* Microcopy */}
                    <div className="text-center text-sm text-[#6B7280]">
                      Instant download • Updates included while subscribed • Email support
                    </div>
                  </div>
                )}

                {/* School Panel */}
                {licence === "school" && (
                  <div className="space-y-6">
                    <div>
                      <h4 className="text-3xl font-bold text-[#16130F]">School licence</h4>
                      <p className="text-[#6B7280] mt-2">Standardise CAPS-aligned letterforms across your whole school.</p>
                    </div>

                    {/* Pricing Display */}
                    <div className="text-center">
                      <div className="text-5xl font-black text-[#16130F]">R399</div>
                      <div className="text-lg text-[#6B7280]">per year</div>
                      <div className="text-sm text-[#6B7280] mt-1">One school • Unlimited educators</div>
                    </div>

                    {/* Features */}
                    <ul className="space-y-3">
                      {[
                        "All Edu-Aid fonts for your school",
                        "Internal sharing with staff allowed",
                        "Print + digital distribution to enrolled learners",
                        "Updates included while subscribed"
                      ].map((feature) => (
                        <li key={feature} className="flex items-start gap-3">
                          <div className="mt-1 flex-shrink-0 w-5 h-5 rounded-full bg-[#00827A] flex items-center justify-center">
                            <svg className="w-3 h-3 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
                            </svg>
                          </div>
                          <span className="text-base leading-relaxed">{feature}</span>
                        </li>
                      ))}
                    </ul>

                    {/* CTA Button */}
                    <button
                      onClick={handlePurchase}
                      className="w-full bg-[#00827A] text-white py-4 px-8 rounded-2xl font-bold text-xl hover:bg-[#006B5E] transition-all duration-200 shadow-lg hover:shadow-xl"
                    >
                      Buy School licence — R399/year
                    </button>

                    {/* Microcopy */}
                    <div className="text-center text-sm text-[#6B7280]">
                      Invoice available • Internal staff sharing allowed • Learner distribution included
                    </div>
                  </div>
                )}

                {/* Commercial & District Panel */}
                {licence === "commercial" && (
                  <div className="space-y-6">
                    <div>
                      <h4 className="text-3xl font-bold text-[#16130F]">Commercial & District</h4>
                      <p className="text-[#6B7280] mt-2">Publishers, apps/SaaS, paid products, districts & bulk rollouts.</p>
                    </div>

                    {/* Pricing Display */}
                    <div className="text-center">
                      <div className="text-3xl font-black text-[#16130F]">Custom licence</div>
                      <div className="text-sm text-[#6B7280] mt-1">We'll quote based on your use case</div>
                    </div>

                    {/* Features */}
                    <ul className="space-y-3">
                      {[
                        "Publishing / paid product licensing",
                        "App & SaaS embedding licenses",
                        "District-wide rollout options",
                        "Onboarding + support available"
                      ].map((feature) => (
                        <li key={feature} className="flex items-start gap-3">
                          <div className="mt-1 flex-shrink-0 w-5 h-5 rounded-full bg-[#00827A] flex items-center justify-center">
                            <svg className="w-3 h-3 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
                            </svg>
                          </div>
                          <span className="text-base leading-relaxed">{feature}</span>
                        </li>
                      ))}
                    </ul>

                    {/* CTA Button */}
                    <button
                      onClick={handlePurchase}
                      className="w-full bg-[#00827A] text-white py-4 px-8 rounded-2xl font-bold text-xl hover:bg-[#006B5E] transition-all duration-200 shadow-lg hover:shadow-xl"
                    >
                      Get a Commercial quote
                    </button>

                    {/* Microcopy */}
                    <div className="text-center text-sm text-[#6B7280]">
                      Typically responds within 1 business day
                    </div>
                  </div>
                )}

                {/* Need help choosing */}
                <div className="mt-8 pt-6 border-t border-white/30">
                  <div className="text-center">
                    <p className="text-[#6B7280] mb-3">Not sure which licence you need?</p>
                    <button
                      onClick={() => setShowCompareModal(true)}
                      className="text-[#00827A] hover:text-[#006B5E] font-semibold underline transition-colors"
                    >
                      Compare licences
                    </button>
                  </div>
                </div>
              </motion.div>
            </div>
          </div>
        </div>

      {/* Compare Modal */}
      {showCompareModal && (
        <div className="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50">
          <motion.div
            initial={{ opacity: 0, scale: 0.9 }}
            animate={{ opacity: 1, scale: 1 }}
            className="bg-white rounded-3xl p-8 max-w-4xl w-full max-h-[90vh] overflow-y-auto"
          >
            <div className="flex justify-between items-center mb-6">
              <h3 className="text-2xl font-bold text-[#16130F]">Compare Licences</h3>
              <button
                onClick={() => setShowCompareModal(false)}
                className="text-[#6B7280] hover:text-[#16130F] text-2xl"
              >
                ×
              </button>
            </div>

            <div className="overflow-x-auto">
              <table className="w-full">
                <thead>
                  <tr className="border-b border-gray-200">
                    <th className="text-left py-4 px-4 font-bold text-[#16130F]">Feature</th>
                    <th className="text-center py-4 px-4 font-bold text-[#16130F]">Individual Educator</th>
                    <th className="text-center py-4 px-4 font-bold text-[#16130F]">School</th>
                    <th className="text-center py-4 px-4 font-bold text-[#16130F]">Commercial & District</th>
                  </tr>
                </thead>
                <tbody>
                  {[
                    { feature: "Who it's for", individual: "Teachers & homeschoolers", school: "Schools & educators", commercial: "Publishers, apps, districts" },
                    { feature: "Install scope", individual: "1 educator", school: "Unlimited educators, 1 school", commercial: "Custom licensing" },
                    { feature: "Outputs allowed", individual: "Print & PDF for learners", school: "Print & digital distribution", commercial: "Publishing & embedding" },
                    { feature: "App/SaaS use", individual: "Not allowed", school: "Not allowed", commercial: "Allowed with licensing" }
                  ].map((row, index) => (
                    <tr key={index} className="border-b border-gray-100">
                      <td className="py-4 px-4 font-semibold text-[#16130F]">{row.feature}</td>
                      <td className="py-4 px-4 text-center text-[#6B7280]">{row.individual}</td>
                      <td className="py-4 px-4 text-center text-[#6B7280]">{row.school}</td>
                      <td className="py-4 px-4 text-center text-[#6B7280]">{row.commercial}</td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          </motion.div>
        </div>
      )}
      </div>

      {/* Bottom wavy blend line */}
      <svg
        className="absolute bottom-0 left-0 w-full h-16"
        viewBox="0 0 1200 60"
        preserveAspectRatio="none"
        aria-hidden="true"
      >
        <path
          d="M0,30 Q300,0 600,30 T1200,30 V60 H0 Z"
          fill="#fef4e6"
        />
      </svg>
    </section>
  );
}
